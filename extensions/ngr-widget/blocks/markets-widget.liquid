{% comment %} theme-check-disable {% endcomment %}
{%- liquid
  assign auto_redirect = app.metafields.markets.auto_redirect | default: false
  assign plan = app.metafields.store_info.plan | default: "Free plan"
  assign host = 'https://ngr-app2.herokuapp.com'
  assign test_mode = block.settings.ngr_test_mode
  assign auto_once = block.settings.ngr_auto_once
  assign auto_once_type = block.settings.ngr_auto_once_type
  assign auto_bots = block.settings.ngr_auto_bots


  if template.name != 'gift_card' and template.name != 'password'
    assign menu_icon = ''
    if block.settings.ngr_menu_icon != blank
      assign menu_icon = block.settings.ngr_menu_icon | image_url: width: 30
    endif
    render 'countries'

    if block.settings.ngr_force_disable == false
      render 'markets_autoredirects', auto_redirect: auto_redirect, plan: plan, host: host, test_mode: test_mode, auto_once: auto_once, auto_once_type: auto_once_type, auto_bots: auto_bots
    endif
    if block.settings.ngr_disable_widget == false
      render 'markets_widget', menu_icon: menu_icon, test_mode: test_mode
    endif
  endif
-%}

{% schema %}
{
  "name": "Markets widget",
  "target": "body",
  "javascript": "native-geo-markets.min.js",
  "stylesheet": "native-geo-markets.min.css",
  "class": "ngr-markets-embed-block",
  "settings": [
    {
      "type": "header",
      "content": "Widget redirects settings"
    },
    {
      "type": "checkbox",
      "id": "ngr_test_mode",
      "info": "You can activate Preview mode and see your current widget. This will only work in Shopify customizer to preview the widget before saving & publishing. It will ignore any GEO location rules and show your widget.",
      "label": "Preview mode",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "ngr_disable_widget",
      "info": "You can emergency disable your widget for all users.",
      "label": "⚠️ Emergency disable widget.",
      "default": false
    },
    {
      "type": "header",
      "content": "Auto redirect settings"
    },
    {
      "type": "checkbox",
      "id": "ngr_force_disable",
      "info": "You can disable all autoredirects. Any autoredirection code is going to be disabled.",
      "label": "⚠️ Emergency disable Auto-redirects.",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "ngr_auto_once",
      "info": "Your store visitors will be auto-redirected only once per session/cookies.",
      "label": "Auto redirect once",
      "default": false
    },
    {
      "type": "select",
      "id": "ngr_auto_once_type",
      "info": "You can choose your 'Auto redirect once' logic.",
      "label": "Auto redirect once type",
      "options": [
        {
          "value": "session",
          "label": "Session"
        },
        {
          "value": "cookies",
          "label": "Cookies"
        }
      ],
      "default": "session"
    },
    {
      "type": "checkbox",
      "id": "ngr_auto_bots",
      "info": "You can enable/disable auto redirects on Web crawlers or search bots.",
      "label": "Disable auto redirects for Web crawlers",
      "default": true
    },
    {
      "type": "header",
      "content": "Other settings"
    },
    {
      "type": "image_picker",
      "id": "ngr_menu_icon",
      "info": "You can set an icon to the custom link with [ngr-markets-icon] string. You can learn more in app dashboard Help & FAQ section.",
      "label": "Select icon"
    }
  ]
}
{% endschema %}
